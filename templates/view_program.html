{% extends "base.html" %}

{% block title %}{{ program.name }}{% endblock %}

{% block content %}
<div class="program-detail-header">
    <div>
        <h1>{{ program.name }}</h1>
        <p class="program-description">{{ program.description }}</p>
        <p class="text-muted">Created: {{ program.created_at.strftime('%Y-%m-%d') if program.created_at.strftime is defined else program.created_at[:10] }}</p>
    </div>
    <div class="header-actions">
        {% if session.role == 'trainer' %}
        <a href="{{ url_for('edit_program', program_id=program.id) }}" class="btn btn-accent">Edit Program</a>
        {% endif %}
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>

<div class="card">
    <h2>Exercises</h2>
    {% if exercises %}
    <div class="exercise-list">
        {% for exercise in exercises %}
        <div class="exercise-card">
            <div class="exercise-header">
                <h3>{{ exercise.exercise_order }}. {{ exercise.name }}</h3>
            </div>
            <div class="exercise-details">
                <div class="exercise-specs">
                    {% if exercise.sets %}
                    <div class="spec-item">
                        <span class="spec-label">Sets:</span>
                        <span class="spec-value">{{ exercise.sets }}</span>
                    </div>
                    {% endif %}
                    {% if exercise.reps %}
                    <div class="spec-item">
                        <span class="spec-label">Reps:</span>
                        <span class="spec-value">{{ exercise.reps }}</span>
                    </div>
                    {% endif %}
                    {% if exercise.weight %}
                    <div class="spec-item">
                        <span class="spec-label">Weight:</span>
                        <span class="spec-value">{{ exercise.weight }}</span>
                    </div>
                    {% endif %}
                    {% if exercise.rest_period %}
                    <div class="spec-item">
                        <span class="spec-label">Rest:</span>
                        <span class="spec-value">{{ exercise.rest_period }}</span>
                    </div>
                    {% endif %}
                    {% if exercise.tempo %}
                    <div class="spec-item">
                        <span class="spec-label">Tempo:</span>
                        <span class="spec-value">{{ exercise.tempo }}</span>
                    </div>
                    {% endif %}
                </div>
                {% if exercise.notes %}
                <div class="exercise-notes">
                    <strong>Notes:</strong> {{ exercise.notes }}
                </div>
                {% endif %}
            </div>
            {% if session.role == 'client' %}
            <div class="workout-log">
                <button class="btn btn-sm btn-primary" onclick="showLogModal({{ exercise.id }}, '{{ exercise.name }}')">Log Workout</button>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="empty-state">No exercises in this program.</p>
    {% endif %}
</div>

<style>
.exercise-specs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
}

.spec-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.spec-label {
    font-size: 0.85rem;
    color: var(--gray-600);
    font-weight: 500;
}

.spec-value {
    font-size: 1.1rem;
    color: var(--navy);
    font-weight: 600;
}

.exercise-notes {
    background: var(--gray-100);
    padding: 0.75rem;
    border-radius: 6px;
    margin-top: 0.75rem;
    line-height: 1.6;
}

@media (max-width: 768px) {
    .exercise-specs {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

{% if session.role == 'client' %}
<!-- Workout Log Modal -->
<div id="logModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeLogModal()">&times;</span>
        <h2>Log Workout: <span id="modalExerciseName"></span></h2>
        <form id="logForm">
            <input type="hidden" id="exerciseId" name="exercise_id">
            <div class="form-group">
                <label>Sets Completed</label>
                <input type="number" id="setsCompleted" name="sets_completed" required>
            </div>
            <div class="form-group">
                <label>Reps Completed</label>
                <input type="number" id="repsCompleted" name="reps_completed" required>
            </div>
            <div class="form-group">
                <label>Weight Used (lbs)</label>
                <input type="number" step="0.5" id="weightUsed" name="weight_used">
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea id="logNotes" name="notes" rows="2"></textarea>
            </div>
            <button type="button" class="btn btn-primary" onclick="submitLog()">Save</button>
            <button type="button" class="btn btn-secondary" onclick="closeLogModal()">Cancel</button>
        </form>
    </div>
</div>

<script>
function showLogModal(exerciseId, exerciseName) {
    document.getElementById('exerciseId').value = exerciseId;
    document.getElementById('modalExerciseName').textContent = exerciseName;
    document.getElementById('logModal').style.display = 'block';
}

function closeLogModal() {
    document.getElementById('logModal').style.display = 'none';
    document.getElementById('logForm').reset();
}

function submitLog() {
    const data = {
        exercise_id: document.getElementById('exerciseId').value,
        sets_completed: document.getElementById('setsCompleted').value,
        reps_completed: document.getElementById('repsCompleted').value,
        weight_used: document.getElementById('weightUsed').value,
        notes: document.getElementById('logNotes').value
    };

    fetch('/api/log_workout', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        closeLogModal();
    })
    .catch(error => {
        alert('Error logging workout');
        console.error('Error:', error);
    });
}
</script>
{% endif %}

{% endblock %}
